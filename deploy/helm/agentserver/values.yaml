replicaCount: 1

image:
  repository: ghcr.io/agentserver/agentserver
  tag: latest
  pullPolicy: Always

postgresql:
  enabled: true
  image:
    repository: registry.nj.cs.ac.cn/dockerhub/postgres
    tag: "18-alpine"
    pullPolicy: IfNotPresent
  auth:
    username: agentserver
    password: agentserver
    database: agentserver
  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: "csi-rbd-sc"
    resources: {}

externalDatabase:
  host: ""
  port: 5432
  user: ""
  password: ""
  database: ""
  sslmode: disable
  # Raw connection URL (overrides individual fields above)
  url: ""
  # Existing K8s secret with a "database-url" key (overrides everything above)
  existingSecret: ""

models:
  anthropicApiKey: ""
  anthropicBaseUrl: ""
  anthropicAuthToken: ""
  # URL that sandbox pods use to reach the Anthropic API proxy on agentserver.
  # If empty, defaults to http://agentserver.<namespace>.svc.cluster.local:8080/proxy/anthropic
  anthropicProxyUrl: ""

platform:
  # Domain for the platform web UI (e.g. "platform.agentserver.dev").
  # Used for OIDC redirect URLs (auto-derived as https://<domain>).
  domain: ""
  defaultQuotas:
    userMaxWorkspaces: 10
    workspaceMaxSandboxes: 20
    maxSandboxCpu: 2000            # millicores (2000 = 2 cores)
    maxSandboxMemory: 2147483648   # bytes (2Gi)
    maxWorkspaceDriveSize: 10737418240  # bytes (10Gi)
    workspaceMaxTotalCpu: 0        # millicores, 0 = unlimited
    workspaceMaxTotalMemory: 0     # bytes, 0 = unlimited
    workspaceMaxIdleTimeout: 0     # seconds, 0 = unlimited
  auth:
    password:
      enabled: true
    oidc:
      github:
        enabled: false
        clientId: ""
        clientSecret: ""
      generic:
        enabled: false
        issuerUrl: ""
        clientId: ""
        clientSecret: ""

sandbox:
  # Base domain for subdomain-based sandbox routing (e.g. "agentserver.dev").
  # Each sandbox gets a subdomain: {prefix}-{sessionID}.{baseDomain}
  baseDomain: ""
  # Prefix for per-workspace K8s namespaces (e.g. "agent-ws" â†’ "agent-ws-a1b2c3d4").
  namespacePrefix: "agent-ws"
  # StorageClass for sandbox session volumes (empty = cluster default).
  sessionStorageClassName: ""
  # StorageClass for workspace drive PVCs (empty = falls back to sessionStorageClassName).
  workspaceStorageClassName: ""
  # Size of the session PVC for each sandbox pod.
  sessionStorageSize: "5Gi"
  opencode:
    image: ghcr.io/agentserver/opencode-agent:latest
    runtimeClassName: ""  # e.g. "gvisor" for gVisor isolation
    subdomainPrefix: "code"  # subdomain: {prefix}-{sessionID}.{baseDomain}
    # Opencode config injected into sandbox pods via OPENCODE_CONFIG_CONTENT.
    # Accepts any valid opencode.json fields as structured YAML.
    config: {}
  openclaw:
    image: ""
    runtimeClassName: ""
    subdomainPrefix: "claw"  # subdomain: {prefix}-{sessionID}.{baseDomain}
  networkPolicy:
    enabled: false
    # CIDR ranges to deny egress to (internal/private networks).
    denyCIDRs: []

agentSandbox:
  # Set to false to skip installing the agent-sandbox controller (if already installed cluster-wide)
  install: true
  controllerImage: registry.k8s.io/agent-sandbox/agent-sandbox-controller:v0.1.1

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: false
  className: nginx
  host: agentserver.example.com
  tls: false

gateway:
  enabled: false
  parentRefs:
    - name: cilium-gateway
      namespace: cilium-gateway
  host: agentserver.example.com
